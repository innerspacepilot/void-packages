# Template file for 'sunxi-mali'
pkgname=libmali
version=20191113
_fullversion="d4000def121b818ae0f583d8372d57643f723fdc"
revision=1

wrksrc=${pkgname}-${_fullversion}
short_desc="Linux sunxi MALI userpace propietary libraries"
maintainer="Orphaned <orphan@voidlinux.org>"
license="MIT"
homepage="https://github.com/LibreELEC/libmali"
nostrip=yes
archs="armv7l"
distfiles="https://github.com/LibreELEC/libmali/archive/${_fullversion}.tar.gz"
checksum=4f2103fc927cc006ee5c9b647e899f50b0dcaeee127fec713387d06a333eb404
provides="libEGL-1.0_1 libGLES-1.0_1"
replaces="libEGL>=0 libGLES>=0"

shlib_provides="
 libEGL.so
 libGLESv2.so
 libGLESv1_CM.so
 libgbm.so"


do_install() {
	vmkdir usr/lib
	vinstall lib/arm-linux-gnueabihf/libmali-utgard-400-r7p0-gbm.so 755 usr/lib

	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libEGL.so
	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libEGL.so.1
	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libGLESv1_CM.so
	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libGLESv1_CM.so.1
	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libGLESv2.so
	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libGLESv2.so.2
	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libMali.so
	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libgbm.so
	ln -srf ${DESTDIR}/usr/lib/libmali-utgard-400-r7p0-gbm.so ${DESTDIR}/usr/lib/libmali.so
}

libmali-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}-${version}_${revision}"
	pkg_install() {
		vmkdir usr
		vcopy include usr
	}
}
